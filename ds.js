!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ds",[],t):"object"==typeof exports?exports.ds=t():e.ds=t()}(this,(function(){return function(e){function t(t){for(var o,r,l=t[0],a=t[1],c=t[2],d=0,p=[];d<l.length;d++)r=l[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&p.push(i[r][0]),i[r]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);for(u&&u(t);p.length;)p.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],o=!0,l=1;l<n.length;l++){var a=n[l];0!==i[a]&&(o=!1)}o&&(s.splice(t--,1),e=r(r.s=n[0]))}return e}var o={},i={3:0},s=[];function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var l=this.webpackJsonp_name_=this.webpackJsonp_name_||[],a=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=a;return s.push([32,0,7]),n()}({32:function(e,t,n){function o(){n(33)}var i=function(){return["filter"in Array.prototype?0:1,"findIndex"in Array.prototype?0:1,"values"in Object?0:1,"Promise"in self?0:1,"endsWith"in String.prototype?0:1,"includes"in String.prototype?0:1,"fetch"in self?0:1]}.call(window);if(-1===i.indexOf(1))o();else{var s=document.createElement("script");s.src="/polyfills."+i.join("")+".js",s.onload=o,s.onerror=function(e){console.error("Could not load the polyfills: "+e)},document.head.appendChild(s)}},33:function(e,t,n){"use strict";n.r(t),function(e){n(68),n(69);var t=n(9),o=n(19),i=n(15),s=n(20),r=n(21),l=n(22),a=n(2);n(34),n(5);t.a.autoReplaceSvg="nest",t.c.add(o.faPlusSquare,i.faPen,s.faSearch,r.faAngleRight,l.faTimes),t.b.watch(),window.jQuery=a,window.$=a;var c=n(36);n(39),n(40);var u=e.env.LEARN_MORE_URL||"https://seamlessaccess.org/about/trust/",d=(e.env.SERVICE_URL,e.env.SERVICE_NAME,c.compile(n(41))),p=c.compile(n(42)),h=c.compile(n(43)),f=c.compile(n(44)),m=c.compile(n(45)),v=c.compile(n(46));a(document).ready((function(){var e=null;a("#notice-and-consent-actions").html(v.render({})),a("#learn-more-banner").html(m.render({learn_more_url:u})),a("#learn-more-trigger, #learn-more-close").on("click",(function(){a("#learn-more-banner").toggleClass("d-none")})),a("#search").on("hidden.bs.collapse",(function(e){a("#choose").toggleClass("d-none"),a("#search").toggleClass("d-none"),a("#searchinput").val("")})).on("shown.bs.collapse",(function(e){a("#choose").toggleClass("d-none"),a("#search").toggleClass("d-none"),a("#searchinput").focus()})),a("#ds-search-list").on("show.bs",(function(t){e=setTimeout((function(){e&&a("#searching").show()}),500)})).on("hide.bs",(function(t){a("#searching").hide(),e&&clearTimeout(e)})),a("#add_button").on("click",(function(e){e.preventDefault(),a("#choose").toggleClass("d-none"),a("#search").toggleClass("d-none")})),a("#edit_button").on("click",(function(e){e.preventDefault(),a("#choosetools").toggleClass("d-none"),a("#done_button").toggleClass("d-none").toggleClass("display-block"),a("#savedchoices").removeClass("choose").addClass("edit"),a("h1.choose").text("Edit institutions"),a("h2.choose").text("If you donâ€™t want an institution to be remembered on this computer, remove it from the list below."),a(".institution-text").addClass("item-fade"),a(".institution-icon").addClass("item-fade"),a(".institution-select").toggleClass("d-none"),a(".institution-remove").toggleClass("d-none")})),a("#done_button").on("click",(function(e){e.preventDefault(),a("#done_button").toggleClass("d-none").toggleClass("display-block"),a("#choosetools").toggleClass("d-none"),a("#savedchoices").removeClass("edit").addClass("choose"),a("h1.choose").text("Choose Your Institution"),a("h2.choose").text("Recent institutions"),a(".institution-text").removeClass("item-fade"),a(".institution-icon").removeClass("item-fade"),a(".institution-select").toggleClass("d-none"),a(".institution-remove").toggleClass("d-none")})),a("#dsclient").discovery_client({mdq:"https://md.thiss.io/entities/",persistence:"https://use.thiss.io/ps/",search:"https://md.thiss.io/entities/",context:"thiss.io",inputfieldselector:"#searchinput",render_search_result:function(t){return a("#searching").hide(),e&&(clearTimeout(e),e=null),d.render(t)},render_saved_choice:function(e){return p.render(e)},too_many_results:function(t,n){e&&(clearTimeout(e),e=null),a("#searching").hide();var o=h.render({count:n});return a("body").on("click","#showall",(function(){t.showall()})),o},no_results:function(){return e&&(clearTimeout(e),e=null),a("#searching").hide(),f.render()},persist:function(){return console.log(a("#rememberThisChoice").is(":checked")),a("#rememberThisChoice").is(":checked")},after:function(e,t){console.log("after - "+e),a("#searching").hide(),0==e?(a("#search").removeClass("d-none"),a("#choose").addClass("d-none"),a("#searchinput").focus()):(a("#choose").removeClass("d-none"),a("#search").addClass("d-none"))}}).discovery_client("sp").then((function(e){return a(".sp_title").text(e.title)}))}))}.call(this,n(11))},39:function(e,t){var n;(n=jQuery).fn.btsListFilter=function(e,t){"use strict";var o,i,s,r,l,a=this,c=n(this),u=n(e),d=c;return t=n.extend({delay:300,minLength:1,initial:!0,casesensitive:!1,eventKey:"keyup",resetOnBlur:!0,sourceData:null,sourceTmpl:'<a class="list-group-item" href="#"><span>{title}</span></a>',sourceNode:function(e){return function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,(function(e,n){return t[n]||""}))}(t.sourceTmpl,e)},emptyNode:function(e){return'<a class="list-group-item well" href="#"><span>No Results</span></a>'},cancelNode:function(){return'<span class="btn glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>'},maxResults:-1,maxResultsNode:function(e){return'<span class="list-groiup-item well">Too many results - keep typing to refine search</span>'},sourceNodes:void 0,loadingClass:"bts-loading-list",itemClassTmp:"bts-dynamic-item",itemEl:".list-group-item",itemChild:null,itemFilter:function(e,o){o=o&&o.replace(new RegExp("[({[^.$*+?\\]})]","g"),"");var i=n(e).text(),s=t.initial?"^":"";return new RegExp(s+o,t.casesensitive?"":"i").test(i)},showEvent:"show.bs",hideEvent:"hide.bs"},t),a.reset=function(){u.val("").trigger(t.eventKey)},a.showall=function(){t.maxResults=-1,u.val(u.val()).trigger(t.eventKey)},n.isFunction(t.cancelNode)&&(o=n(t.cancelNode.call(a)).hide(),u.after(o),u.parents(".form-group").addClass("has-feedback"),u.prev().is(".control-label")||o.css({top:0}),o.css({"pointer-events":"auto"}),o.on("click",a.reset)),u.on(t.eventKey,(s=function(e){var s=n(this).val();t.itemEl&&(d=c.find(t.itemEl)),t.itemChild&&(d=d.find(t.itemChild));var r=d.filter((function(){return t.itemFilter.call(a,this,s)})),l=d.not(r);t.itemChild&&(r=r.parents(t.itemEl),l=l.parents(t.itemEl).hide()),""!==s&&s.length>=t.minLength?(r.show(),l.hide(),o.show(),a.trigger(t.showEvent),"function"===n.type(t.sourceData)?(r.hide(),l.hide(),i&&(n.isFunction(i.abort)?i.abort():n.isFunction(i.stop)&&i.stop()),c.addClass(t.loadingClass),i=t.sourceData.call(a,s,(function(e){if(i=null,r.hide(),l.hide(),c.find("."+t.itemClassTmp).remove(),t.sourceNodes)t.sourceNodes.call(a,t,s,e,(function(e){n(e).addClass(t.itemClassTmp).appendTo(c)}));else if(e&&0!==e.length)if(t.maxResults<0||e.length<=t.maxResults)for(var o in e)n(t.sourceNode.call(a,e[o])).addClass(t.itemClassTmp).appendTo(c);else n(t.maxResultsNode(e)).addClass(t.itemClassTmp).appendTo(c);else n(t.emptyNode.call(a,s)).addClass(t.itemClassTmp).appendTo(c);c.removeClass(t.loadingClass)}))):(c.find("."+t.itemClassTmp).remove(),0===r.length&&n(t.emptyNode.call(a,s)).addClass(t.itemClassTmp).appendTo(c))):(r.show(),l.show(),o.hide(),a.trigger(t.hideEvent),c.find("."+t.itemClassTmp).remove())},r=(r=t.delay)||300,function(){var e=this,t=arguments;clearTimeout(l),l=setTimeout((function(){s.apply(e,Array.prototype.slice.call(t))}),r)})),t.resetOnBlur&&u.on("blur",(function(e){a.reset()})),c}},40:function(e,t,n){"use strict";n.r(t);var o=n(5);jQuery((function(e){e.widget("thiss.discovery_client",{options:{persistence:void 0,search:void 0,mdq:void 0,context:void 0,before:void 0,after:void 0,render:void 0,render_search_result:void 0,render_saved_choice:void 0,fallback_icon:void 0,input_field_selector:"input",search_result_selector:"#ds-search-list",saved_choices_selector:"#ds-saved-choices",entity_selector:".identityprovider",too_many_results:void 0,no_results:void 0,persist:void 0},_create:function(){var t=this;e.isFunction(t.options.render)||(t.options.render=e.noop),e.isFunction(t.options.search)||(t.options.search_url=t.options.search,t.options.search=function(e,n){return Object(o.json_mdq_search)(e,t.options.search_url).then((function(e){return e.filter((function(e){return"true"!=e.hidden}))})).then(n)}),e.isFunction(t.options.render_search_result)||(t.options.render_search_result=t.options.render),e.isFunction(t.options.render_saved_choice)||(t.options.render_saved_choice=t.options.render),e.isFunction(t.options.fallback_icon)||(t.options.fallback_icon=e.noop),e.isFunction(t.options.after)||(t.options.after=e.noop),e.isFunction(t.options.before)||(t.options.before=function(e){return e}),e.isFunction(t.options.persist)||(t.options.persist=function(){return!0}),t._update()},_setOption:function(e,t){this.options[e]=t,this._update()},sp:function(){var e=Object(o.parse_qs)(window.location.search.substr(1).split("&")).entityID;return e?this._ds.mdq(e).then((function(t){return t||Promise.resolve({entity_id:e,title:e})})):(console.log("Missing entityID parameter in discovery request"),{title:"Unknown"})},_after:function(t){var n=e(this.options.saved_choices_selector);if(this.options.search){var o=this,i=e(o.options.search_result_selector),s=0;e(o.options.input_field_selector).focus(),i.btsListFilter(o.options.input_field_selector,{resetOnBlur:!1,casesensitive:!1,maxResults:10,itemEl:o.options.entity_selector,getValue:function(e){var t=e.val(),n=t.indexOf("@");return n>-1?t.substring(n+1,t.length):t},sourceNodes:function(e,t,n,i){if(0!=n.length&&n)if(e.maxResults>0&&n.length>e.maxResults)i(o.options.too_many_results(this,n.length));else for(var r in n){var l=n[r];s+=1,l.counter=s,l.saved=!1,i(o.options.render_search_result(l))}else i(o.options.no_results(t))},sourceData:o.options.search,cancelNode:function(){console.log("cancel")}})}this.options.after(t,n)},_update:function(){var t=this;t._ds=new o.DiscoveryService(t.options.mdq,t.options.persistence,t.options.context),t._count=0;t.element;e("img.pyff-idp-icon").bind("error",(function(){e(this).unbind("error"),t.options.fallback_icon(this)})),e("body").on("mouseenter",t.options.entity_selector,(function(t){e(this).addClass("active")})),e("body").on("mouseleave",t.options.entity_selector,(function(t){e(this).removeClass("active")})),e("body").on("click",t.options.entity_selector,(function(n){var o=e(this).closest(t.options.entity_selector).attr("data-href");return console.log(o),t._ds.saml_discovery_response(o,t.options.persist())})),e("body").on("keyup",t.options.entity_selector,(function(t){13===t.keyCode&&(t.preventDefault(),e(this).click())})),e(t.options.input_field_selector).closest("form").submit((function(e){e.preventDefault()})),e("body").on("click",".remove",(function(n){n.stopPropagation();var o=e(this).closest(t.options.entity_selector);t._count=o.siblings().length+1;var i=o.attr("data-href");console.log("removing "+i),console.log(o),i&&t._ds.remove(i).then((function(){o.remove()})).then((function(){t._count-=1,t._after(t._count)}))})),t._ds.with_items((function(n){console.log(n),n=t.options.before(n);var o=0,i=e(t.options.saved_choices_selector);return console.log(n),n&&n.length>0&&n.forEach((function(e){var n=e.entity;n.saved=!0;var s=t.options.render_saved_choice(n);i.prepend(s),o++})),t._after(o),n}))}})}))},41:function(e,t){e.exports='<a class="institution identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li><i class="arrow fa fa-angle-right"></i>\n        <div class="d-block institution-text">\n            <div class="text-truncate label primary">{{title}}</div>\n            <div class="text-truncate label-url secondary">{{domain}}</div>\n        </div>\n    </li>\n</a>'},42:function(e,t){e.exports='<a class="identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li class="institution clearfix">\n        <i class="institution-remove remove top-right fa fa-times d-none"></i>\n        {{#entity_icon}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon}}" />\n        </div>\n        {{/entity_icon}}\n        {{#entity_icon_url}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon_url.url}}" />\n        </div>\n        {{/entity_icon_url}}\n        {{^entity_icon_url}}\n        {{^entity_icon}}\n            <svg class="institution-icon logo"\n                 width="40"\n                 height="40">\n                <circle cx="20" cy="20" r="20" fill="#aeaeae" />\n                <text x="50%"\n                      y="50%"\n                      text-anchor="middle"\n                      fill="white"\n                      font-size="12px"\n                      font-family="Arial"\n                      dy=".3em">{{name_tag}}</text>\n            </svg>\n        {{/entity_icon}}\n        {{/entity_icon_url}}\n        <div class="institution-text">\n            <i class="institution-select arrow fa fa-angle-right"></i>\n            <div class="primary">{{title}}</div>\n            <span class="secondary">{{domain}}</span>\n        </div>\n    </li>\n</a>\n'},43:function(e,t){e.exports='<li class="type-ahead-alert">\n    <div role="alert">\n        <p><span class="bold">{{count}} Matches</span> keep typing to refine your search</p>\n        <p><a id="showall" href="#">Show me all matches anyway</a></p>\n    </div>\n</li>\n'},44:function(e,t){e.exports='<li>\n    <div class="no-results-alert" role="alert">\n        <h3 class="bold">No matching institutions found</h3>\n        <ul>\n            <li>Try entering an institution name, abbreviation or your institution email</li>\n            <li>Try accessing through your library website</li>\n            <li>Contact your librarian</li>\n        </ul>\n    </div>\n</li>'},45:function(e,t){e.exports='<div class="row">\n    <div class="col py-2 px-4">\n        <i id="learn-more-close" class="fa fa-times"></i>\n        <p>\n            The institution you select will be saved in the browser local storage of this device and will be made\n            available to this and other sites that use <a href="{{service_url}}">{{service_name}}</a>. You\n            may clear your browser local storage at any time.\n        </p>\n\n        <p>\n            No login, email or personal information is stored.\n        </p>\n\n        <p class="text-center mb-0">\n            <a href="{{learn_more_url}}">\n                Additional Privacy Information\n            </a>\n        </p>\n    </div>\n</div>\n'},46:function(e,t){e.exports='<div class="row">\n    <div class="col col-auto pr-3">\n        <div class="custom-control custom-checkbox">\n            <input type="checkbox" class="custom-control-input" checked="checked" id="rememberThisChoice">\n            <label class="custom-control-label" for="rememberThisChoice">\n                Remember this choice\n            </label>\n        </div>\n    </div>\n    <div class="col pl-2">\n        <p class="mb-0">\n            <a id="learn-more-trigger" href="#">Learn More</a>\n        </p>\n    </div>\n</div>\n'},68:function(e,t){},69:function(e,t){}})}));