!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ds",[],t):"object"==typeof exports?exports.ds=t():e.ds=t()}(this,(function(){return function(e){function t(t){for(var o,r,c=t[0],a=t[1],l=t[2],d=0,p=[];d<c.length;d++)r=c[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&p.push(i[r][0]),i[r]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);for(u&&u(t);p.length;)p.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],o=!0,c=1;c<n.length;c++){var a=n[c];0!==i[a]&&(o=!1)}o&&(s.splice(t--,1),e=r(r.s=n[0]))}return e}var o={},i={3:0},s=[];function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var c=this.webpackJsonp_name_=this.webpackJsonp_name_||[],a=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=a;return s.push([32,0,7]),n()}({32:function(e,t,n){function o(){n(33)}var i=function(){return["filter"in Array.prototype?0:1,"findIndex"in Array.prototype?0:1,"values"in Object?0:1,"Promise"in self?0:1,"endsWith"in String.prototype?0:1,"includes"in String.prototype?0:1,"fetch"in self?0:1]}.call(window);if(-1===i.indexOf(1))o();else{var s=document.createElement("script");s.src="/polyfills."+i.join("")+".js",s.onload=o,s.onerror=function(e){console.error("Could not load the polyfills: "+e)},document.head.appendChild(s)}},33:function(e,t,n){"use strict";n.r(t);n(66);var o=n(9),i=n(15),s=n(19),r=n(20),c=n(21),a=n(22),l=n(2);n(34),n(5);o.a.autoReplaceSvg="nest",o.c.add(i.faPlusSquare,s.faPen,r.faSearch,c.faAngleRight,a.faTimes),o.b.watch(),window.jQuery=l,window.$=l;var u=n(36);n(39),n(40);var d=u.compile(n(41)),p=u.compile(n(42)),f=u.compile(n(43)),h=u.compile(n(44));l(document).ready((function(){var e=null;l("#search").on("hidden.bs.collapse",(function(e){l("#choose").toggleClass("d-none"),l("#search").toggleClass("d-none"),l("#searchinput").val("")})).on("shown.bs.collapse",(function(e){l("#choose").toggleClass("d-none"),l("#search").toggleClass("d-none"),l("#searchinput").focus()})),l("#ds-search-list").on("show.bs",(function(t){e=setTimeout((function(){l("#searching").show()}),500)})).on("hide.bs",(function(t){l("#searching").hide(),e&&clearTimeout(e)})),l("#add_button").on("click",(function(e){e.preventDefault(),l("#choose").toggleClass("d-none"),l("#search").toggleClass("d-none")})),l("#edit_button").on("click",(function(e){e.preventDefault(),l("#choosetools").toggleClass("d-none"),l("#done_button").toggleClass("d-none").toggleClass("display-block"),l("#savedchoices").removeClass("choose").addClass("edit"),l(".institution-text").addClass("item-fade"),l(".institution-icon").addClass("item-fade"),l(".institution-select").toggleClass("d-none"),l(".institution-remove").toggleClass("d-none")})),l("#done_button").on("click",(function(e){e.preventDefault(),l("#done_button").toggleClass("d-none").toggleClass("display-block"),l("#choosetools").toggleClass("d-none"),l("#savedchoices").removeClass("edit").addClass("choose"),l(".institution-text").removeClass("item-fade"),l(".institution-icon").removeClass("item-fade"),l(".institution-select").toggleClass("d-none"),l(".institution-remove").toggleClass("d-none")})),l("#dsclient").discovery_client({mdq:"https://md.thiss.io/entities/",persistence:"https://use.thiss.io/ps/",search:"https://md.thiss.io/entities/",context:"thiss.io",inputfieldselector:"#searchinput",render_search_result:function(t){return console.log("render_search_result"),e&&(clearTimeout(e),e=null),l("#searching").hide(),d.render(t)},render_saved_choice:function(e){return p.render(e)},too_many_results:function(t){return e&&(clearTimeout(e),e=null),l("#searching").hide(),f.render({count:t})},no_results:function(){return e&&(clearTimeout(e),e=null),l("#searching").hide(),h.render()},after:function(e,t){console.log("after - "+e),l("#searching").hide(),0==e?(l("#search").removeClass("d-none"),l("#choose").addClass("d-none"),l("#searchinput").focus()):(l("#choose").removeClass("d-none"),l("#search").addClass("d-none"))}}).discovery_client("sp").then((function(e){return l(".sp_title").text(e.title)}))}))},40:function(e,t,n){"use strict";n.r(t);var o=n(5);jQuery((function(e){e.widget("thiss.discovery_client",{options:{persistence:void 0,search:void 0,mdq:void 0,context:void 0,before:void 0,after:void 0,render:void 0,render_search_result:void 0,render_saved_choice:void 0,fallback_icon:void 0,input_field_selector:"input",search_result_selector:"#ds-search-list",saved_choices_selector:"#ds-saved-choices",entity_selector:".identityprovider",too_many_results:void 0,no_results:void 0},_create:function(){var t=this;e.isFunction(t.options.render)||(t.options.render=e.noop),e.isFunction(t.options.search)||(t.options.search_url=t.options.search,t.options.search=function(e,n){return Object(o.json_mdq_search)(e,t.options.search_url).then((function(e){return e.filter((function(e){return"true"!=e.hidden}))})).then(n)}),e.isFunction(t.options.render_search_result)||(t.options.render_search_result=t.options.render),e.isFunction(t.options.render_saved_choice)||(t.options.render_saved_choice=t.options.render),e.isFunction(t.options.fallback_icon)||(t.options.fallback_icon=e.noop),e.isFunction(t.options.after)||(t.options.after=e.noop),e.isFunction(t.options.before)||(t.options.before=function(e){return e}),t._update()},_setOption:function(e,t){this.options[e]=t,this._update()},sp:function(){var e=Object(o.parse_qs)(window.location.search.substr(1).split("&")).entityID;return e?this._ds.mdq(e).then((function(t){return t||Promise.resolve({entity_id:e,title:e})})):(console.log("Missing entityID parameter in discovery request"),{title:"Unknown"})},_after:function(t){var n=e(this.options.saved_choices_selector);if(this.options.search){var o=this,i=e(o.options.search_result_selector),s=0;e(o.options.input_field_selector).focus(),i.btsListFilter(o.options.input_field_selector,{resetOnBlur:!1,casesensitive:!1,maxResults:10,itemEl:o.options.entity_selector,emptyNode:o.options.no_results,getValue:function(e){var t=e.val(),n=t.indexOf("@");return n>-1?t.substring(n+1,t.length):t},maxResultsNode:function(e){return o.options.too_many_results(e.length)},sourceData:o.options.search,sourceNode:function(e){return s+=1,e.counter=s,e.saved=!1,o.options.render_search_result(e)},cancelNode:function(){console.log("cancel")}})}this.options.after(t,n)},_update:function(){var t=this;t._ds=new o.DiscoveryService(t.options.mdq,t.options.persistence,t.options.context),t._count=0;t.element;e("img.pyff-idp-icon").bind("error",(function(){e(this).unbind("error"),t.options.fallback_icon(this)})),e("body").on("mouseenter",t.options.entity_selector,(function(t){e(this).addClass("active")})),e("body").on("mouseleave",t.options.entity_selector,(function(t){e(this).removeClass("active")})),e("body").on("click",t.options.entity_selector,(function(n){var o=e(this).closest(t.options.entity_selector).attr("data-href");return console.log(o),t._ds.saml_discovery_response(o)})),e("body").on("keyup",t.options.entity_selector,(function(t){13===t.keyCode&&(t.preventDefault(),e(this).click())})),e(t.options.input_field_selector).closest("form").submit((function(e){e.preventDefault()})),e("body").on("click",".remove",(function(n){n.stopPropagation();var o=e(this).closest(t.options.entity_selector);t._count=o.siblings().length+1;var i=o.attr("data-href");console.log("removing "+i),console.log(o),i&&t._ds.remove(i).then((function(){o.remove()})).then((function(){t._count-=1,t._after(t._count)}))})),t._ds.with_items((function(n){console.log(n),n=t.options.before(n);var o=0,i=e(t.options.saved_choices_selector);return console.log(n),n&&n.length>0&&n.forEach((function(e){var n=e.entity;n.saved=!0;var s=t.options.render_saved_choice(n);i.prepend(s),o++})),t._after(o),n}))}})}))},41:function(e,t){e.exports='<a class="institution identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li><i class="arrow fa fa-angle-right"></i>\n        <div class="d-block institution-text">\n            <div class="text-truncate label primary">{{title}}</div>\n            <div class="text-truncate label-url secondary">{{domain}}</div>\n        </div>\n    </li>\n</a>'},42:function(e,t){e.exports='<a class="identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li class="institution clearfix">\n        <i class="institution-remove remove top-right fa fa-times d-none"></i>\n        {{#entity_icon}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon}}" />\n        </div>\n        {{/entity_icon}}\n        {{#entity_icon_url}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon_url.url}}" />\n        </div>\n        {{/entity_icon_url}}\n        {{^entity_icon_url}}\n        {{^entity_icon}}\n            <svg class="institution-icon logo"\n                 width="40"\n                 height="40">\n                <circle cx="20" cy="20" r="20" fill="#aeaeae" />\n                <text x="50%"\n                      y="50%"\n                      text-anchor="middle"\n                      fill="white"\n                      font-size="12px"\n                      font-family="Arial"\n                      dy=".3em">{{name_tag}}</text>\n            </svg>\n        {{/entity_icon}}\n        {{/entity_icon_url}}\n        <div class="institution-text">\n            <i class="institution-select arrow fa fa-angle-right"></i>\n            <div class="primary">{{title}}</div>\n            <span class="secondary">{{domain}}</span>\n        </div>\n    </li>\n</a>\n'},43:function(e,t){e.exports='<li class="type-ahead-alert">\n    <div role="alert">\n        <p><span class="bold">{{count}} Matches</span> keep typing to refine your search</p>\n    </div>\n</li>'},44:function(e,t){e.exports='<li>\n    <div class="no-results-alert" role="alert">\n        <h3 class="bold">No matching institutions found</h3>\n        <ul>\n            <li>Try entering an institution name, abbreviation or your institution email</li>\n            <li>Try accessing through your library website</li>\n            <li>Contact your librarian</li>\n        </ul>\n    </div>\n</li>'},66:function(e,t){}})}));