!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("ds",[],n):"object"==typeof exports?exports.ds=n():e.ds=n()}(this,(function(){return function(e){function n(n){for(var o,r,l=n[0],a=n[1],c=n[2],d=0,p=[];d<l.length;d++)r=l[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&p.push(i[r][0]),i[r]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);for(u&&u(n);p.length;)p.shift()();return s.push.apply(s,c||[]),t()}function t(){for(var e,n=0;n<s.length;n++){for(var t=s[n],o=!0,l=1;l<t.length;l++){var a=t[l];0!==i[a]&&(o=!1)}o&&(s.splice(n--,1),e=r(r.s=t[0]))}return e}var o={},i={3:0},s=[];function r(n){if(o[n])return o[n].exports;var t=o[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=e,r.c=o,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)r.d(t,o,function(n){return e[n]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="/";var l=this.webpackJsonp_name_=this.webpackJsonp_name_||[],a=l.push.bind(l);l.push=n,l=l.slice();for(var c=0;c<l.length;c++)n(l[c]);var u=a;return s.push([32,0,7]),t()}({32:function(e,n,t){function o(){t(33)}var i=function(){return["filter"in Array.prototype?0:1,"findIndex"in Array.prototype?0:1,"values"in Object?0:1,"Promise"in self?0:1,"endsWith"in String.prototype?0:1,"includes"in String.prototype?0:1,"fetch"in self?0:1]}.call(window);if(-1===i.indexOf(1))o();else{var s=document.createElement("script");s.src="/polyfills."+i.join("")+".js",s.onload=o,s.onerror=function(e){console.error("Could not load the polyfills: "+e)},document.head.appendChild(s)}},33:function(e,n,t){"use strict";t.r(n),function(e){t(68),t(69);var n=t(9),o=t(15),i=t(19),s=t(20),r=t(21),l=t(22),a=t(2);t(34),t(5);n.a.autoReplaceSvg="nest",n.c.add(o.faPlusSquare,i.faPen,s.faSearch,r.faAngleRight,l.faTimes),n.b.watch(),window.jQuery=a,window.$=a;var c=t(36);t(39),t(40);var u=e.env.LEARN_MORE_URL||"https://seamlessaccess.org/about/trust/",d=c.compile(t(41)),p=c.compile(t(42)),h=c.compile(t(43)),f=c.compile(t(44)),m=c.compile(t(45)),v=c.compile(t(46));a(document).ready((function(){var e=null;a("#notice-and-consent-actions").html(v.render({})),a("#learn-more-banner").html(m.render({learn_more_url:u})),a("#learn-more-trigger, #learn-more-close").on("click",(function(){a("#learn-more-banner").toggleClass("d-none")})),a("#search").on("hidden.bs.collapse",(function(e){a("#choose").toggleClass("d-none"),a("#search").toggleClass("d-none"),a("#searchinput").val("")})).on("shown.bs.collapse",(function(e){a("#choose").toggleClass("d-none"),a("#search").toggleClass("d-none"),a("#searchinput").focus()})),a("#ds-search-list").on("show.bs",(function(n){e=setTimeout((function(){e&&a("#searching").show()}),500)})).on("hide.bs",(function(n){a("#searching").hide(),e&&clearTimeout(e)})),a("#add_button").on("click",(function(e){e.preventDefault(),a("#choose").toggleClass("d-none"),a("#search").toggleClass("d-none")})),a("#edit_button").on("click",(function(e){e.preventDefault(),a("#choosetools").toggleClass("d-none"),a("#done_button").toggleClass("d-none").toggleClass("display-block"),a("#savedchoices").removeClass("choose").addClass("edit"),a(".institution-text").addClass("item-fade"),a(".institution-icon").addClass("item-fade"),a(".institution-select").toggleClass("d-none"),a(".institution-remove").toggleClass("d-none")})),a("#done_button").on("click",(function(e){e.preventDefault(),a("#done_button").toggleClass("d-none").toggleClass("display-block"),a("#choosetools").toggleClass("d-none"),a("#savedchoices").removeClass("edit").addClass("choose"),a(".institution-text").removeClass("item-fade"),a(".institution-icon").removeClass("item-fade"),a(".institution-select").toggleClass("d-none"),a(".institution-remove").toggleClass("d-none")})),a("#dsclient").discovery_client({mdq:"https://md.thiss.io/entities/",persistence:"https://use.thiss.io/ps/",search:"https://md.thiss.io/entities/",context:"thiss.io",inputfieldselector:"#searchinput",render_search_result:function(n){return a("#searching").hide(),e&&(clearTimeout(e),e=null),d.render(n)},render_saved_choice:function(e){return p.render(e)},too_many_results:function(n,t){e&&(clearTimeout(e),e=null),a("#searching").hide();var o=h.render({count:t});return a("body").on("click","#showall",(function(){n.showall()})),o},no_results:function(){return e&&(clearTimeout(e),e=null),a("#searching").hide(),f.render()},persist:function(){return console.log(a("#rememberThisChoice").is(":checked")),a("#rememberThisChoice").is(":checked")},after:function(e,n){console.log("after - "+e),a("#searching").hide(),0==e?(a("#search").removeClass("d-none"),a("#choose").addClass("d-none"),a("#searchinput").focus()):(a("#choose").removeClass("d-none"),a("#search").addClass("d-none"))}}).discovery_client("sp").then((function(e){return a(".sp_title").text(e.title)}))}))}.call(this,t(11))},39:function(e,n){var t;(t=jQuery).fn.btsListFilter=function(e,n){"use strict";var o,i,s,r,l,a=this,c=t(this),u=t(e),d=c;return n=t.extend({delay:300,minLength:1,initial:!0,casesensitive:!1,eventKey:"keyup",resetOnBlur:!0,sourceData:null,sourceTmpl:'<a class="list-group-item" href="#"><span>{title}</span></a>',sourceNode:function(e){return function(e,n){return e.replace(/\{ *([\w_]+) *\}/g,(function(e,t){return n[t]||""}))}(n.sourceTmpl,e)},emptyNode:function(e){return'<a class="list-group-item well" href="#"><span>No Results</span></a>'},cancelNode:function(){return'<span class="btn glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>'},maxResults:-1,maxResultsNode:function(e){return'<span class="list-groiup-item well">Too many results - keep typing to refine search</span>'},sourceNodes:void 0,loadingClass:"bts-loading-list",itemClassTmp:"bts-dynamic-item",itemEl:".list-group-item",itemChild:null,itemFilter:function(e,o){o=o&&o.replace(new RegExp("[({[^.$*+?\\]})]","g"),"");var i=t(e).text(),s=n.initial?"^":"";return new RegExp(s+o,n.casesensitive?"":"i").test(i)},showEvent:"show.bs",hideEvent:"hide.bs"},n),a.reset=function(){u.val("").trigger(n.eventKey)},a.showall=function(){n.maxResults=-1,u.val(u.val()).trigger(n.eventKey)},t.isFunction(n.cancelNode)&&(o=t(n.cancelNode.call(a)).hide(),u.after(o),u.parents(".form-group").addClass("has-feedback"),u.prev().is(".control-label")||o.css({top:0}),o.css({"pointer-events":"auto"}),o.on("click",a.reset)),u.on(n.eventKey,(s=function(e){var s=t(this).val();n.itemEl&&(d=c.find(n.itemEl)),n.itemChild&&(d=d.find(n.itemChild));var r=d.filter((function(){return n.itemFilter.call(a,this,s)})),l=d.not(r);n.itemChild&&(r=r.parents(n.itemEl),l=l.parents(n.itemEl).hide()),""!==s&&s.length>=n.minLength?(r.show(),l.hide(),o.show(),a.trigger(n.showEvent),"function"===t.type(n.sourceData)?(r.hide(),l.hide(),i&&(t.isFunction(i.abort)?i.abort():t.isFunction(i.stop)&&i.stop()),c.addClass(n.loadingClass),i=n.sourceData.call(a,s,(function(e){if(i=null,r.hide(),l.hide(),c.find("."+n.itemClassTmp).remove(),n.sourceNodes)n.sourceNodes.call(a,n,s,e,(function(e){t(e).addClass(n.itemClassTmp).appendTo(c)}));else if(e&&0!==e.length)if(n.maxResults<0||e.length<=n.maxResults)for(var o in e)t(n.sourceNode.call(a,e[o])).addClass(n.itemClassTmp).appendTo(c);else t(n.maxResultsNode(e)).addClass(n.itemClassTmp).appendTo(c);else t(n.emptyNode.call(a,s)).addClass(n.itemClassTmp).appendTo(c);c.removeClass(n.loadingClass)}))):(c.find("."+n.itemClassTmp).remove(),0===r.length&&t(n.emptyNode.call(a,s)).addClass(n.itemClassTmp).appendTo(c))):(r.show(),l.show(),o.hide(),a.trigger(n.hideEvent),c.find("."+n.itemClassTmp).remove())},r=(r=n.delay)||300,function(){var e=this,n=arguments;clearTimeout(l),l=setTimeout((function(){s.apply(e,Array.prototype.slice.call(n))}),r)})),n.resetOnBlur&&u.on("blur",(function(e){a.reset()})),c}},40:function(e,n,t){"use strict";t.r(n);var o=t(5);jQuery((function(e){e.widget("thiss.discovery_client",{options:{persistence:void 0,search:void 0,mdq:void 0,context:void 0,before:void 0,after:void 0,render:void 0,render_search_result:void 0,render_saved_choice:void 0,fallback_icon:void 0,input_field_selector:"input",search_result_selector:"#ds-search-list",saved_choices_selector:"#ds-saved-choices",entity_selector:".identityprovider",too_many_results:void 0,no_results:void 0,persist:void 0},_create:function(){var n=this;e.isFunction(n.options.render)||(n.options.render=e.noop),e.isFunction(n.options.search)||(n.options.search_url=n.options.search,n.options.search=function(e,t){return Object(o.json_mdq_search)(e,n.options.search_url).then((function(e){return e.filter((function(e){return"true"!=e.hidden}))})).then(t)}),e.isFunction(n.options.render_search_result)||(n.options.render_search_result=n.options.render),e.isFunction(n.options.render_saved_choice)||(n.options.render_saved_choice=n.options.render),e.isFunction(n.options.fallback_icon)||(n.options.fallback_icon=e.noop),e.isFunction(n.options.after)||(n.options.after=e.noop),e.isFunction(n.options.before)||(n.options.before=function(e){return e}),e.isFunction(n.options.persist)||(n.options.persist=function(){return!0}),n._update()},_setOption:function(e,n){this.options[e]=n,this._update()},sp:function(){var e=Object(o.parse_qs)(window.location.search.substr(1).split("&")).entityID;return e?this._ds.mdq(e).then((function(n){return n||Promise.resolve({entity_id:e,title:e})})):(console.log("Missing entityID parameter in discovery request"),{title:"Unknown"})},_after:function(n){var t=e(this.options.saved_choices_selector);if(this.options.search){var o=this,i=e(o.options.search_result_selector),s=0;e(o.options.input_field_selector).focus(),i.btsListFilter(o.options.input_field_selector,{resetOnBlur:!1,casesensitive:!1,maxResults:10,itemEl:o.options.entity_selector,getValue:function(e){var n=e.val(),t=n.indexOf("@");return t>-1?n.substring(t+1,n.length):n},sourceNodes:function(e,n,t,i){if(0!=t.length&&t)if(e.maxResults>0&&t.length>e.maxResults)i(o.options.too_many_results(this,t.length));else for(var r in t){var l=t[r];s+=1,l.counter=s,l.saved=!1,i(o.options.render_search_result(l))}else i(o.options.no_results(n))},sourceData:o.options.search,cancelNode:function(){console.log("cancel")}})}this.options.after(n,t)},_update:function(){var n=this;n._ds=new o.DiscoveryService(n.options.mdq,n.options.persistence,n.options.context),n._count=0;n.element;e("img.pyff-idp-icon").bind("error",(function(){e(this).unbind("error"),n.options.fallback_icon(this)})),e("body").on("mouseenter",n.options.entity_selector,(function(n){e(this).addClass("active")})),e("body").on("mouseleave",n.options.entity_selector,(function(n){e(this).removeClass("active")})),e("body").on("click",n.options.entity_selector,(function(t){var o=e(this).closest(n.options.entity_selector).attr("data-href");return console.log(o),n._ds.saml_discovery_response(o,n.options.persist())})),e("body").on("keyup",n.options.entity_selector,(function(n){13===n.keyCode&&(n.preventDefault(),e(this).click())})),e(n.options.input_field_selector).closest("form").submit((function(e){e.preventDefault()})),e("body").on("click",".remove",(function(t){t.stopPropagation();var o=e(this).closest(n.options.entity_selector);n._count=o.siblings().length+1;var i=o.attr("data-href");console.log("removing "+i),console.log(o),i&&n._ds.remove(i).then((function(){o.remove()})).then((function(){n._count-=1,n._after(n._count)}))})),n._ds.with_items((function(t){console.log(t),t=n.options.before(t);var o=0,i=e(n.options.saved_choices_selector);return console.log(t),t&&t.length>0&&t.forEach((function(e){var t=e.entity;t.saved=!0;var s=n.options.render_saved_choice(t);i.prepend(s),o++})),n._after(o),t}))}})}))},41:function(e,n){e.exports='<a class="institution identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li><i class="arrow fa fa-angle-right"></i>\n        <div class="d-block institution-text">\n            <div class="text-truncate label primary">{{title}}</div>\n            <div class="text-truncate label-url secondary">{{domain}}</div>\n        </div>\n    </li>\n</a>'},42:function(e,n){e.exports='<a class="identityprovider" tabindex="0" data-href="{{entity_id}}">\n    <li class="institution clearfix">\n        <i class="institution-remove remove top-right fa fa-times d-none"></i>\n        {{#entity_icon}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon}}" />\n        </div>\n        {{/entity_icon}}\n        {{#entity_icon_url}}\n        <div class="institution-mask">\n            <img class="institution-icon" alt="{{name_tag}}" src="{{entity_icon_url.url}}" />\n        </div>\n        {{/entity_icon_url}}\n        {{^entity_icon_url}}\n        {{^entity_icon}}\n            <svg class="institution-icon logo"\n                 width="40"\n                 height="40">\n                <circle cx="20" cy="20" r="20" fill="#aeaeae" />\n                <text x="50%"\n                      y="50%"\n                      text-anchor="middle"\n                      fill="white"\n                      font-size="12px"\n                      font-family="Arial"\n                      dy=".3em">{{name_tag}}</text>\n            </svg>\n        {{/entity_icon}}\n        {{/entity_icon_url}}\n        <div class="institution-text">\n            <i class="institution-select arrow fa fa-angle-right"></i>\n            <div class="primary">{{title}}</div>\n            <span class="secondary">{{domain}}</span>\n        </div>\n    </li>\n</a>\n'},43:function(e,n){e.exports='<li class="type-ahead-alert">\n    <div role="alert">\n        <p><span class="bold">{{count}} Matches</span> keep typing to refine your search</p>\n        <p><a id="showall" href="#">Show me all matches anyway</a></p>\n    </div>\n</li>\n'},44:function(e,n){e.exports='<li>\n    <div class="no-results-alert" role="alert">\n        <h3 class="bold">No matching institutions found</h3>\n        <ul>\n            <li>Try entering an institution name, abbreviation or your institution email</li>\n            <li>Try accessing through your library website</li>\n            <li>Contact your librarian</li>\n        </ul>\n    </div>\n</li>'},45:function(e,n){e.exports='<div class="row">\n    <div class="col py-2 px-4">\n        <i id="learn-more-close" class="fa fa-times"></i>\n        <p>\n            The institution you select will be saved in this device\'s browser storage\n            for use with thiss and other sites that use <a href="https://seamlessaccess.org">SeamlessAccess</a>.\n            You may clear your browser storage at any time.\n        </p>\n\n        <p>\n            No login, email or personal information is stored.\n        </p>\n\n        <p class="text-center mb-0">\n            <a href="{{learn_more_url}}">\n                Additional Privacy Information\n            </a>\n        </p>\n    </div>\n</div>\n'},46:function(e,n){e.exports='<div class="row">\n    <div class="col col-auto pr-3">\n        <div class="custom-control custom-checkbox">\n            <input type="checkbox" class="custom-control-input" checked="checked" id="rememberThisChoice">\n            <label class="custom-control-label" for="rememberThisChoice">\n                Remember this choice\n            </label>\n        </div>\n    </div>\n    <div class="col pl-2">\n        <p class="mb-0">\n            <a id="learn-more-trigger" href="#">Learn More</a>\n        </p>\n    </div>\n</div>\n'},68:function(e,n){},69:function(e,n){}})}));